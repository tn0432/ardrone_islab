<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T1U3">x_est</span>=estimate_rincf_drone(<span class="mxinfo" id="T1:U2"><span class="mxinfo" id="T1:U3"><span class="var type1" id="S2T1U6">x_est</span></span></span>,<span class="var type1" id="S3T2U7">omega</span>,<span class="var type1" id="S4T2U8">acc</span>,<span class="var type1" id="S5T2U9">mag</span>,<span class="var type1" id="S6T11U10">K_ss</span>,<span class="var type1" id="S7T3U11">g_e</span>,<span class="var type1" id="S8T3U12">b_e</span>,<span class="var type1" id="S9T4U13">dt</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line">    <span class="mxinfo" id="T4:U12"><span class="var type1" id="S10T4U16">wmx</span>=<span class="mxinfo" id="T4:U14"><span class="var type1" id="S3T2U18">omega</span>(<span class="mxinfo" id="T4:U16">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line">    <span class="mxinfo" id="T4:U17"><span class="var type1" id="S11T4U22">wmy</span>=<span class="mxinfo" id="T4:U19"><span class="var type1" id="S3T2U24">omega</span>(<span class="mxinfo" id="T4:U21">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line">    <span class="mxinfo" id="T4:U22"><span class="var type1" id="S12T4U28">wmz</span>=<span class="mxinfo" id="T4:U24"><span class="var type1" id="S3T2U30">omega</span>(<span class="mxinfo" id="T4:U26">3</span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line">    <span class="mxinfo" id="T4:U27"><span class="var type1" id="S13T4U34">amx</span>=<span class="mxinfo" id="T4:U29"><span class="var type1" id="S4T2U36">acc</span>(<span class="mxinfo" id="T4:U31">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line">    <span class="mxinfo" id="T4:U32"><span class="var type1" id="S14T4U40">amy</span>=<span class="mxinfo" id="T4:U34"><span class="var type1" id="S4T2U42">acc</span>(<span class="mxinfo" id="T4:U36">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line">    <span class="mxinfo" id="T4:U37"><span class="var type1" id="S15T4U46">amz</span>=<span class="mxinfo" id="T4:U39"><span class="var type1" id="S4T2U48">acc</span>(<span class="mxinfo" id="T4:U41">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line">    <span class="mxinfo" id="T4:U42"><span class="var type1" id="S16T4U52">bmx</span>=<span class="mxinfo" id="T4:U44"><span class="var type1" id="S5T2U54">mag</span>(<span class="mxinfo" id="T4:U46">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line">    <span class="mxinfo" id="T4:U47"><span class="var type1" id="S17T4U58">bmy</span>=<span class="mxinfo" id="T4:U49"><span class="var type1" id="S5T2U60">mag</span>(<span class="mxinfo" id="T4:U51">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line">    <span class="mxinfo" id="T4:U52"><span class="var type1" id="S18T4U64">bmz</span>=<span class="mxinfo" id="T4:U54"><span class="var type1" id="S5T2U66">mag</span>(<span class="mxinfo" id="T4:U56">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line">    <span class="comment">%g_e=double([0 0 -9.81]');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line">    <span class="comment">%b_e=double([0.3793   -0.2157    0.8998]');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line">    <span class="mxinfo" id="T4:U57"><span class="var type1" id="S19T4U70">gex</span>=<span class="mxinfo" id="T4:U59"><span class="var type1" id="S7T3U72">g_e</span>(<span class="mxinfo" id="T4:U61">1</span>)</span></span>;<span class="mxinfo" id="T4:U62"><span class="var type1" id="S20T4U76">gey</span>=<span class="mxinfo" id="T4:U64"><span class="var type1" id="S7T3U78">g_e</span>(<span class="mxinfo" id="T4:U66">2</span>)</span></span>;<span class="mxinfo" id="T4:U67"><span class="var type1" id="S21T4U82">gez</span>=<span class="mxinfo" id="T4:U69"><span class="var type1" id="S7T3U84">g_e</span>(<span class="mxinfo" id="T4:U71">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line">    <span class="mxinfo" id="T4:U72"><span class="var type1" id="S22T4U88">bex</span>=<span class="mxinfo" id="T4:U74"><span class="var type1" id="S8T3U90">b_e</span>(<span class="mxinfo" id="T4:U76">1</span>)</span></span>;<span class="mxinfo" id="T4:U77"><span class="var type1" id="S23T4U94">bey</span>=<span class="mxinfo" id="T4:U79"><span class="var type1" id="S8T3U96">b_e</span>(<span class="mxinfo" id="T4:U81">2</span>)</span></span>;<span class="mxinfo" id="T4:U82"><span class="var type1" id="S24T4U100">bez</span>=<span class="mxinfo" id="T4:U84"><span class="var type1" id="S8T3U102">b_e</span>(<span class="mxinfo" id="T4:U86">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line">    <span class="comment">%Rbe=double(eye(3));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line">    <span class="mxinfo" id="T3:U87"><span class="var type1" id="S25T3U106">accp</span>=double(<span class="mxinfo" id="T3:U89">[0 0 0]'</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line">    <span class="mxinfo" id="T3:U90"><span class="var type1" id="S27T3U117">magp</span>=double(<span class="mxinfo" id="T3:U92">[0 0 0]'</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line">    <span class="comment">%I34=[zeros(3,1) eye(3)];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line">    <span class="mxinfo" id="T4:U93"><span class="var type1" id="S28T4U128">q0</span>=<span class="mxinfo" id="T4:U95"><span class="var type1" id="S2T1U130">x_est</span>(<span class="mxinfo" id="T4:U97">1</span>)</span></span>;<span class="mxinfo" id="T4:U98"><span class="var type1" id="S29T4U134">q1</span>=<span class="mxinfo" id="T4:U100"><span class="var type1" id="S2T1U136">x_est</span>(<span class="mxinfo" id="T4:U102">2</span>)</span></span>;<span class="mxinfo" id="T4:U103"><span class="var type1" id="S30T4U140">q2</span>=<span class="mxinfo" id="T4:U105"><span class="var type1" id="S2T1U142">x_est</span>(<span class="mxinfo" id="T4:U107">3</span>)</span></span>;<span class="mxinfo" id="T4:U108"><span class="var type1" id="S31T4U146">q3</span>=<span class="mxinfo" id="T4:U110"><span class="var type1" id="S2T1U148">x_est</span>(<span class="mxinfo" id="T4:U112">4</span>)</span></span>;<span class="mxinfo" id="T4:U113"><span class="var type1" id="S32T4U152">wbx</span>=<span class="mxinfo" id="T4:U115"><span class="var type1" id="S2T1U154">x_est</span>(<span class="mxinfo" id="T4:U117">5</span>)</span></span>;<span class="mxinfo" id="T4:U118"><span class="var type1" id="S33T4U158">wby</span>=<span class="mxinfo" id="T4:U120"><span class="var type1" id="S2T1U160">x_est</span>(<span class="mxinfo" id="T4:U122">6</span>)</span></span>;<span class="mxinfo" id="T4:U123"><span class="var type1" id="S34T4U164">wbz</span>=<span class="mxinfo" id="T4:U125"><span class="var type1" id="S2T1U166">x_est</span>(<span class="mxinfo" id="T4:U127">7</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line">    <span class="comment">%states</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line">    <span class="comment">%qt=[q0 q1 q2 q3]';                  %quarternions</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line">    <span class="comment">%w_b=[wbx wby wbz]';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line">    <span class="mxinfo" id="T1:U128"><span class="var type1" id="S35T1U170">x</span>=<span class="mxinfo" id="T1:U130"><span class="mxinfo" id="T16:U131">[<span class="var type1" id="S28T4U174">q0</span> <span class="var type1" id="S29T4U175">q1</span> <span class="var type1" id="S30T4U176">q2</span> <span class="var type1" id="S31T4U177">q3</span> <span class="var type1" id="S32T4U178">wbx</span> <span class="var type1" id="S33T4U179">wby</span> <span class="var type1" id="S34T4U180">wbz</span>]</span>'</span></span>;                       <span class="comment">%states</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line">    <span class="mxinfo" id="T1:U139"><span class="var type1" id="S36T1U183">xdot</span> =<span class="mxinfo" id="T1:U141">[ <span class="mxinfo" id="T4:U142"><span class="mxinfo" id="T4:U143"><span class="mxinfo" id="T4:U144">(<span class="mxinfo" id="T4:U145"><span class="var type1" id="S29T4U191">q1</span>*(<span class="mxinfo" id="T4:U147"><span class="var type1" id="S32T4U194">wbx</span> - <span class="var type1" id="S10T4U195">wmx</span></span>)</span>)/<span class="mxinfo" id="T4:U150">2</span></span> + <span class="mxinfo" id="T4:U151">(<span class="mxinfo" id="T4:U152"><span class="var type1" id="S30T4U200">q2</span>*(<span class="mxinfo" id="T4:U154"><span class="var type1" id="S33T4U203">wby</span> - <span class="var type1" id="S11T4U204">wmy</span></span>)</span>)/<span class="mxinfo" id="T4:U157">2</span></span></span> + <span class="mxinfo" id="T4:U158">(<span class="mxinfo" id="T4:U159"><span class="var type1" id="S31T4U209">q3</span>*(<span class="mxinfo" id="T4:U161"><span class="var type1" id="S34T4U212">wbz</span> - <span class="var type1" id="S12T4U213">wmz</span></span>)</span>)/<span class="mxinfo" id="T4:U164">2</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo" id="T1:U139"><span class="mxinfo" id="T1:U141">            <span class="mxinfo" id="T4:U165"><span class="mxinfo" id="T4:U166"><span class="mxinfo" id="T4:U167">(<span class="mxinfo" id="T4:U168"><span class="var type1" id="S31T4U221">q3</span>*(<span class="mxinfo" id="T4:U170"><span class="var type1" id="S33T4U224">wby</span> - <span class="var type1" id="S11T4U225">wmy</span></span>)</span>)/<span class="mxinfo" id="T4:U173">2</span></span> - <span class="mxinfo" id="T4:U174">(<span class="mxinfo" id="T4:U175"><span class="var type1" id="S28T4U230">q0</span>*(<span class="mxinfo" id="T4:U177"><span class="var type1" id="S32T4U233">wbx</span> - <span class="var type1" id="S10T4U234">wmx</span></span>)</span>)/<span class="mxinfo" id="T4:U180">2</span></span></span> - <span class="mxinfo" id="T4:U181">(<span class="mxinfo" id="T4:U182"><span class="var type1" id="S30T4U239">q2</span>*(<span class="mxinfo" id="T4:U184"><span class="var type1" id="S34T4U242">wbz</span> - <span class="var type1" id="S12T4U243">wmz</span></span>)</span>)/<span class="mxinfo" id="T4:U187">2</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo" id="T1:U139"><span class="mxinfo" id="T1:U141">            <span class="mxinfo" id="T4:U188"><span class="mxinfo" id="T4:U189"><span class="mxinfo" id="T4:U190">(<span class="mxinfo" id="T4:U191"><span class="var type1" id="S29T4U251">q1</span>*(<span class="mxinfo" id="T4:U193"><span class="var type1" id="S34T4U254">wbz</span> - <span class="var type1" id="S12T4U255">wmz</span></span>)</span>)/<span class="mxinfo" id="T4:U196">2</span></span> - <span class="mxinfo" id="T4:U197">(<span class="mxinfo" id="T4:U198"><span class="var type1" id="S28T4U260">q0</span>*(<span class="mxinfo" id="T4:U200"><span class="var type1" id="S33T4U263">wby</span> - <span class="var type1" id="S11T4U264">wmy</span></span>)</span>)/<span class="mxinfo" id="T4:U203">2</span></span></span> - <span class="mxinfo" id="T4:U204">(<span class="mxinfo" id="T4:U205"><span class="var type1" id="S31T4U269">q3</span>*(<span class="mxinfo" id="T4:U207"><span class="var type1" id="S32T4U272">wbx</span> - <span class="var type1" id="S10T4U273">wmx</span></span>)</span>)/<span class="mxinfo" id="T4:U210">2</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo" id="T1:U139"><span class="mxinfo" id="T1:U141">            <span class="mxinfo" id="T4:U211"><span class="mxinfo" id="T4:U212"><span class="mxinfo" id="T4:U213">(<span class="mxinfo" id="T4:U214"><span class="var type1" id="S30T4U281">q2</span>*(<span class="mxinfo" id="T4:U216"><span class="var type1" id="S32T4U284">wbx</span> - <span class="var type1" id="S10T4U285">wmx</span></span>)</span>)/<span class="mxinfo" id="T4:U219">2</span></span> - <span class="mxinfo" id="T4:U220">(<span class="mxinfo" id="T4:U221"><span class="var type1" id="S29T4U290">q1</span>*(<span class="mxinfo" id="T4:U223"><span class="var type1" id="S33T4U293">wby</span> - <span class="var type1" id="S11T4U294">wmy</span></span>)</span>)/<span class="mxinfo" id="T4:U226">2</span></span></span> - <span class="mxinfo" id="T4:U227">(<span class="mxinfo" id="T4:U228"><span class="var type1" id="S28T4U299">q0</span>*(<span class="mxinfo" id="T4:U230"><span class="var type1" id="S34T4U302">wbz</span> - <span class="var type1" id="S12T4U303">wmz</span></span>)</span>)/<span class="mxinfo" id="T4:U233">2</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo" id="T1:U139"><span class="mxinfo" id="T1:U141">                                                                       <span class="mxinfo" id="T4:U234">0</span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo" id="T1:U139"><span class="mxinfo" id="T1:U141">                                                                       <span class="mxinfo" id="T4:U235">0</span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo" id="T1:U139"><span class="mxinfo" id="T1:U141">                                                                       <span class="mxinfo" id="T4:U236">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line">    <span class="mxinfo" id="T1:U237"><span class="var type1" id="S35T1U313">x</span>=<span class="mxinfo" id="T1:U239"><span class="var type1" id="S35T1U315">x</span>+<span class="mxinfo" id="T1:U241"><span class="var type1" id="S36T1U317">xdot</span>.*<span class="var type1" id="S9T4U318">dt</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line">    <span class="comment">%normalize quaternion</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line">    <span class="mxinfo" id="T4:U244"><span class="var type1" id="S37T4U321">qnorm</span>=<span class="mxinfo" id="T4:U246">sqrt(<span class="mxinfo" id="T4:U247"><span class="mxinfo" id="T4:U248"><span class="mxinfo" id="T4:U249"><span class="mxinfo" id="T4:U250"><span class="mxinfo" id="T4:U251"><span class="var type1" id="S35T1U329">x</span>(<span class="mxinfo" id="T4:U253">1</span>)</span>^2</span>+<span class="mxinfo" id="T4:U254"><span class="mxinfo" id="T4:U255"><span class="var type1" id="S35T1U334">x</span>(<span class="mxinfo" id="T4:U257">2</span>)</span>^2</span></span>+<span class="mxinfo" id="T4:U258"><span class="mxinfo" id="T4:U259"><span class="var type1" id="S35T1U339">x</span>(<span class="mxinfo" id="T4:U261">3</span>)</span>^2</span></span>+<span class="mxinfo" id="T4:U262"><span class="mxinfo" id="T4:U263"><span class="var type1" id="S35T1U344">x</span>(<span class="mxinfo" id="T4:U265">4</span>)</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line">    <span class="mxinfo" id="T1:U266"><span class="var type1" id="S35T1U349">x</span>=<span class="mxinfo" id="T1:U268"><span class="mxinfo" id="T16:U269">[<span class="mxinfo" id="T4:U270"><span class="mxinfo" id="T4:U271"><span class="var type1" id="S35T1U355">x</span>(<span class="mxinfo" id="T4:U273">1</span>)</span>/<span class="var type1" id="S37T4U357">qnorm</span></span> <span class="mxinfo" id="T4:U275"><span class="mxinfo" id="T4:U276"><span class="var type1" id="S35T1U360">x</span>(<span class="mxinfo" id="T4:U278">2</span>)</span>/<span class="var type1" id="S37T4U362">qnorm</span></span> <span class="mxinfo" id="T4:U280"><span class="mxinfo" id="T4:U281"><span class="var type1" id="S35T1U365">x</span>(<span class="mxinfo" id="T4:U283">3</span>)</span>/<span class="var type1" id="S37T4U367">qnorm</span></span> <span class="mxinfo" id="T4:U285"><span class="mxinfo" id="T4:U286"><span class="var type1" id="S35T1U370">x</span>(<span class="mxinfo" id="T4:U288">4</span>)</span>/<span class="var type1" id="S37T4U372">qnorm</span></span> <span class="mxinfo" id="T4:U290"><span class="var type1" id="S35T1U374">x</span>(<span class="mxinfo" id="T4:U292">5</span>)</span> <span class="mxinfo" id="T4:U293"><span class="var type1" id="S35T1U377">x</span>(<span class="mxinfo" id="T4:U295">6</span>)</span> <span class="mxinfo" id="T4:U296"><span class="var type1" id="S35T1U380">x</span>(<span class="mxinfo" id="T4:U298">7</span>)</span>]</span>'</span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">    <span class="mxinfo" id="T4:U299"><span class="var type1" id="S28T4U384">q0</span>=<span class="mxinfo" id="T4:U301"><span class="var type1" id="S35T1U386">x</span>(<span class="mxinfo" id="T4:U303">1</span>)</span></span>;<span class="mxinfo" id="T4:U304"><span class="var type1" id="S29T4U390">q1</span>=<span class="mxinfo" id="T4:U306"><span class="var type1" id="S35T1U392">x</span>(<span class="mxinfo" id="T4:U308">2</span>)</span></span>;<span class="mxinfo" id="T4:U309"><span class="var type1" id="S30T4U396">q2</span>=<span class="mxinfo" id="T4:U311"><span class="var type1" id="S35T1U398">x</span>(<span class="mxinfo" id="T4:U313">3</span>)</span></span>;<span class="mxinfo" id="T4:U314"><span class="var type1" id="S31T4U402">q3</span>=<span class="mxinfo" id="T4:U316"><span class="var type1" id="S35T1U404">x</span>(<span class="mxinfo" id="T4:U318">4</span>)</span></span>;<span class="comment">%wbx=x(5);wby=x(6);wbz=x(7);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%     accp=[gez*(2*q0*q2 - 2*q1*q3) - gey*(2*q0*q3 + 2*q1*q2) - gex*(q0^2 + q1^2 - q2^2 - q3^2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%         gex*(2*q0*q3 - 2*q1*q2) - gey*(q0^2 - q1^2 + q2^2 - q3^2) - gez*(2*q0*q1 + 2*q2*q3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%         gey*(2*q0*q1 - 2*q2*q3) - gex*(2*q0*q2 + 2*q1*q3) - gez*(q0^2 - q1^2 - q2^2 + q3^2)];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%     magp=[bex*(q0^2 + q1^2 - q2^2 - q3^2) + bey*(2*q0*q3 + 2*q1*q2) - bez*(2*q0*q2 - 2*q1*q3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%         bey*(q0^2 - q1^2 + q2^2 - q3^2) - bex*(2*q0*q3 - 2*q1*q2) + bez*(2*q0*q1 + 2*q2*q3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%         bez*(q0^2 - q1^2 - q2^2 + q3^2) + bex*(2*q0*q2 + 2*q1*q3) - bey*(2*q0*q1 - 2*q2*q3)];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%     </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%     y_est=[accp;  magp];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%      E=    [ q2*(q1*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) - q0*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q2*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)))) - q0*(q2*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q3*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q0*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)))) - q1*(q3*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) - q2*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q1*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)))) - q3*(q1*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q0*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) - q3*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2))));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%                 q0*(q1*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q0*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) - q3*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)))) - q1*(q1*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) - q0*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q2*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)))) - q3*(q2*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q3*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q0*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)))) - q2*(q3*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) - q2*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q1*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2))));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%                 q0*(q1*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) - q0*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q2*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)))) + q1*(q1*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q0*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) - q3*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)))) + q2*(q2*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q3*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q0*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)))) - q3*(q3*(amx*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2)) - amy*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) - q2*(amx*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gex*q0 + gey*q3 - gez*q2) - q2*(gex*q2 - gey*q1 + gez*q0) + q1*(gex*q1 + gey*q2 + gez*q3) + q3*(gey*q0 - gex*q3 + gez*q1))) + q1*(amy*(q0*(gex*q2 - gey*q1 + gez*q0) - q1*(gey*q0 - gex*q3 + gez*q1) + q2*(gex*q0 + gey*q3 - gez*q2) + q3*(gex*q1 + gey*q2 + gez*q3)) - amz*(q0*(gey*q0 - gex*q3 + gez*q1) + q1*(gex*q2 - gey*q1 + gez*q0) + q2*(gex*q1 + gey*q2 + gez*q3) - q3*(gex*q0 + gey*q3 - gez*q2))));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%                 q0*(q2*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q3*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q0*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)))) - q2*(q1*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) - q0*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q2*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)))) + q1*(q3*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) - q2*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q1*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)))) + q3*(q1*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q0*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) - q3*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2))));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%                 q1*(q1*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) - q0*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q2*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)))) - q0*(q1*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q0*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) - q3*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)))) + q3*(q2*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q3*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q0*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)))) + q2*(q3*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) - q2*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q1*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2))));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%                 q3*(q3*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) - q2*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q1*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)))) - q1*(q1*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q0*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) - q3*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)))) - q2*(q2*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q3*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q0*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)))) - q0*(q1*(bmx*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) - q0*(bmx*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2)) - bmy*(q0*(bex*q0 + bey*q3 - bez*q2) - q2*(bex*q2 - bey*q1 + bez*q0) + q1*(bex*q1 + bey*q2 + bez*q3) + q3*(bey*q0 - bex*q3 + bez*q1))) + q2*(bmy*(q0*(bex*q2 - bey*q1 + bez*q0) - q1*(bey*q0 - bex*q3 + bez*q1) + q2*(bex*q0 + bey*q3 - bez*q2) + q3*(bex*q1 + bey*q2 + bez*q3)) - bmz*(q0*(bey*q0 - bex*q3 + bez*q1) + q1*(bex*q2 - bey*q1 + bez*q0) + q2*(bex*q1 + bey*q2 + bez*q3) - q3*(bex*q0 + bey*q3 - bez*q2))))];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line">          </span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line">    <span class="mxinfo" id="T12:U319"><span class="var type1" id="S39T12U408">E</span> = <span class="mxinfo" id="T12:U321">[<span class="mxinfo" id="T4:U322"><span class="mxinfo" id="T4:U323"><span class="var type1" id="S20T4U413">gey</span>*(<span class="mxinfo" id="T4:U325"><span class="mxinfo" id="T4:U326"><span class="mxinfo" id="T4:U327"><span class="var type1" id="S15T4U418">amz</span>*(<span class="mxinfo" id="T4:U329"><span class="mxinfo" id="T4:U330"><span class="mxinfo" id="T4:U331"><span class="mxinfo" id="T4:U332"><span class="var type1" id="S28T4U424">q0</span>^2</span> - <span class="mxinfo" id="T4:U334"><span class="var type1" id="S29T4U427">q1</span>^2</span></span> - <span class="mxinfo" id="T4:U336"><span class="var type1" id="S30T4U430">q2</span>^2</span></span> + <span class="mxinfo" id="T4:U338"><span class="var type1" id="S31T4U433">q3</span>^2</span></span>)</span> - <span class="mxinfo" id="T4:U340"><span class="var type1" id="S13T4U436">amx</span>*(<span class="mxinfo" id="T4:U342"><span class="mxinfo" id="T4:U343"><span class="mxinfo" id="T4:U344"><span class="mxinfo" id="T4:U345">2</span>*<span class="var type1" id="S28T4U442">q0</span></span>*<span class="var type1" id="S30T4U443">q2</span></span> - <span class="mxinfo" id="T4:U348"><span class="mxinfo" id="T4:U349"><span class="mxinfo" id="T4:U350">2</span>*<span class="var type1" id="S29T4U447">q1</span></span>*<span class="var type1" id="S31T4U448">q3</span></span></span>)</span></span> + <span class="mxinfo" id="T4:U353"><span class="var type1" id="S14T4U450">amy</span>*(<span class="mxinfo" id="T4:U355"><span class="mxinfo" id="T4:U356"><span class="mxinfo" id="T4:U357"><span class="mxinfo" id="T4:U358">2</span>*<span class="var type1" id="S28T4U456">q0</span></span>*<span class="var type1" id="S29T4U457">q1</span></span> + <span class="mxinfo" id="T4:U361"><span class="mxinfo" id="T4:U362"><span class="mxinfo" id="T4:U363">2</span>*<span class="var type1" id="S30T4U461">q2</span></span>*<span class="var type1" id="S31T4U462">q3</span></span></span>)</span></span>)</span> - <span class="mxinfo" id="T4:U366"><span class="var type1" id="S21T4U464">gez</span>*(<span class="mxinfo" id="T4:U368"><span class="mxinfo" id="T4:U369"><span class="mxinfo" id="T4:U370"><span class="var type1" id="S14T4U469">amy</span>*(<span class="mxinfo" id="T4:U372"><span class="mxinfo" id="T4:U373"><span class="mxinfo" id="T4:U374"><span class="mxinfo" id="T4:U375"><span class="var type1" id="S28T4U475">q0</span>^2</span> - <span class="mxinfo" id="T4:U377"><span class="var type1" id="S29T4U478">q1</span>^2</span></span> + <span class="mxinfo" id="T4:U379"><span class="var type1" id="S30T4U481">q2</span>^2</span></span> - <span class="mxinfo" id="T4:U381"><span class="var type1" id="S31T4U484">q3</span>^2</span></span>)</span> + <span class="mxinfo" id="T4:U383"><span class="var type1" id="S13T4U487">amx</span>*(<span class="mxinfo" id="T4:U385"><span class="mxinfo" id="T4:U386"><span class="mxinfo" id="T4:U387"><span class="mxinfo" id="T4:U388">2</span>*<span class="var type1" id="S28T4U493">q0</span></span>*<span class="var type1" id="S31T4U494">q3</span></span> + <span class="mxinfo" id="T4:U391"><span class="mxinfo" id="T4:U392"><span class="mxinfo" id="T4:U393">2</span>*<span class="var type1" id="S29T4U498">q1</span></span>*<span class="var type1" id="S30T4U499">q2</span></span></span>)</span></span> - <span class="mxinfo" id="T4:U396"><span class="var type1" id="S15T4U501">amz</span>*(<span class="mxinfo" id="T4:U398"><span class="mxinfo" id="T4:U399"><span class="mxinfo" id="T4:U400"><span class="mxinfo" id="T4:U401">2</span>*<span class="var type1" id="S28T4U507">q0</span></span>*<span class="var type1" id="S29T4U508">q1</span></span> - <span class="mxinfo" id="T4:U404"><span class="mxinfo" id="T4:U405"><span class="mxinfo" id="T4:U406">2</span>*<span class="var type1" id="S30T4U512">q2</span></span>*<span class="var type1" id="S31T4U513">q3</span></span></span>)</span></span>)</span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo" id="T12:U319"><span class="mxinfo" id="T12:U321">        <span class="mxinfo" id="T4:U409"><span class="mxinfo" id="T4:U410"><span class="var type1" id="S21T4U517">gez</span>*(<span class="mxinfo" id="T4:U412"><span class="mxinfo" id="T4:U413"><span class="mxinfo" id="T4:U414"><span class="var type1" id="S13T4U522">amx</span>*(<span class="mxinfo" id="T4:U416"><span class="mxinfo" id="T4:U417"><span class="mxinfo" id="T4:U418"><span class="mxinfo" id="T4:U419"><span class="var type1" id="S28T4U528">q0</span>^2</span> + <span class="mxinfo" id="T4:U421"><span class="var type1" id="S29T4U531">q1</span>^2</span></span> - <span class="mxinfo" id="T4:U423"><span class="var type1" id="S30T4U534">q2</span>^2</span></span> - <span class="mxinfo" id="T4:U425"><span class="var type1" id="S31T4U537">q3</span>^2</span></span>)</span> - <span class="mxinfo" id="T4:U427"><span class="var type1" id="S14T4U540">amy</span>*(<span class="mxinfo" id="T4:U429"><span class="mxinfo" id="T4:U430"><span class="mxinfo" id="T4:U431"><span class="mxinfo" id="T4:U432">2</span>*<span class="var type1" id="S28T4U546">q0</span></span>*<span class="var type1" id="S31T4U547">q3</span></span> - <span class="mxinfo" id="T4:U435"><span class="mxinfo" id="T4:U436"><span class="mxinfo" id="T4:U437">2</span>*<span class="var type1" id="S29T4U551">q1</span></span>*<span class="var type1" id="S30T4U552">q2</span></span></span>)</span></span> + <span class="mxinfo" id="T4:U440"><span class="var type1" id="S15T4U554">amz</span>*(<span class="mxinfo" id="T4:U442"><span class="mxinfo" id="T4:U443"><span class="mxinfo" id="T4:U444"><span class="mxinfo" id="T4:U445">2</span>*<span class="var type1" id="S28T4U560">q0</span></span>*<span class="var type1" id="S30T4U561">q2</span></span> + <span class="mxinfo" id="T4:U448"><span class="mxinfo" id="T4:U449"><span class="mxinfo" id="T4:U450">2</span>*<span class="var type1" id="S29T4U565">q1</span></span>*<span class="var type1" id="S31T4U566">q3</span></span></span>)</span></span>)</span> - <span class="mxinfo" id="T4:U453"><span class="var type1" id="S19T4U568">gex</span>*(<span class="mxinfo" id="T4:U455"><span class="mxinfo" id="T4:U456"><span class="mxinfo" id="T4:U457"><span class="var type1" id="S15T4U573">amz</span>*(<span class="mxinfo" id="T4:U459"><span class="mxinfo" id="T4:U460"><span class="mxinfo" id="T4:U461"><span class="mxinfo" id="T4:U462"><span class="var type1" id="S28T4U579">q0</span>^2</span> - <span class="mxinfo" id="T4:U464"><span class="var type1" id="S29T4U582">q1</span>^2</span></span> - <span class="mxinfo" id="T4:U466"><span class="var type1" id="S30T4U585">q2</span>^2</span></span> + <span class="mxinfo" id="T4:U468"><span class="var type1" id="S31T4U588">q3</span>^2</span></span>)</span> - <span class="mxinfo" id="T4:U470"><span class="var type1" id="S13T4U591">amx</span>*(<span class="mxinfo" id="T4:U472"><span class="mxinfo" id="T4:U473"><span class="mxinfo" id="T4:U474"><span class="mxinfo" id="T4:U475">2</span>*<span class="var type1" id="S28T4U597">q0</span></span>*<span class="var type1" id="S30T4U598">q2</span></span> - <span class="mxinfo" id="T4:U478"><span class="mxinfo" id="T4:U479"><span class="mxinfo" id="T4:U480">2</span>*<span class="var type1" id="S29T4U602">q1</span></span>*<span class="var type1" id="S31T4U603">q3</span></span></span>)</span></span> + <span class="mxinfo" id="T4:U483"><span class="var type1" id="S14T4U605">amy</span>*(<span class="mxinfo" id="T4:U485"><span class="mxinfo" id="T4:U486"><span class="mxinfo" id="T4:U487"><span class="mxinfo" id="T4:U488">2</span>*<span class="var type1" id="S28T4U611">q0</span></span>*<span class="var type1" id="S29T4U612">q1</span></span> + <span class="mxinfo" id="T4:U491"><span class="mxinfo" id="T4:U492"><span class="mxinfo" id="T4:U493">2</span>*<span class="var type1" id="S30T4U616">q2</span></span>*<span class="var type1" id="S31T4U617">q3</span></span></span>)</span></span>)</span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo" id="T12:U319"><span class="mxinfo" id="T12:U321">        <span class="mxinfo" id="T4:U496"><span class="mxinfo" id="T4:U497"><span class="var type1" id="S19T4U621">gex</span>*(<span class="mxinfo" id="T4:U499"><span class="mxinfo" id="T4:U500"><span class="mxinfo" id="T4:U501"><span class="var type1" id="S14T4U626">amy</span>*(<span class="mxinfo" id="T4:U503"><span class="mxinfo" id="T4:U504"><span class="mxinfo" id="T4:U505"><span class="mxinfo" id="T4:U506"><span class="var type1" id="S28T4U632">q0</span>^2</span> - <span class="mxinfo" id="T4:U508"><span class="var type1" id="S29T4U635">q1</span>^2</span></span> + <span class="mxinfo" id="T4:U510"><span class="var type1" id="S30T4U638">q2</span>^2</span></span> - <span class="mxinfo" id="T4:U512"><span class="var type1" id="S31T4U641">q3</span>^2</span></span>)</span> + <span class="mxinfo" id="T4:U514"><span class="var type1" id="S13T4U644">amx</span>*(<span class="mxinfo" id="T4:U516"><span class="mxinfo" id="T4:U517"><span class="mxinfo" id="T4:U518"><span class="mxinfo" id="T4:U519">2</span>*<span class="var type1" id="S28T4U650">q0</span></span>*<span class="var type1" id="S31T4U651">q3</span></span> + <span class="mxinfo" id="T4:U522"><span class="mxinfo" id="T4:U523"><span class="mxinfo" id="T4:U524">2</span>*<span class="var type1" id="S29T4U655">q1</span></span>*<span class="var type1" id="S30T4U656">q2</span></span></span>)</span></span> - <span class="mxinfo" id="T4:U527"><span class="var type1" id="S15T4U658">amz</span>*(<span class="mxinfo" id="T4:U529"><span class="mxinfo" id="T4:U530"><span class="mxinfo" id="T4:U531"><span class="mxinfo" id="T4:U532">2</span>*<span class="var type1" id="S28T4U664">q0</span></span>*<span class="var type1" id="S29T4U665">q1</span></span> - <span class="mxinfo" id="T4:U535"><span class="mxinfo" id="T4:U536"><span class="mxinfo" id="T4:U537">2</span>*<span class="var type1" id="S30T4U669">q2</span></span>*<span class="var type1" id="S31T4U670">q3</span></span></span>)</span></span>)</span> - <span class="mxinfo" id="T4:U540"><span class="var type1" id="S20T4U672">gey</span>*(<span class="mxinfo" id="T4:U542"><span class="mxinfo" id="T4:U543"><span class="mxinfo" id="T4:U544"><span class="var type1" id="S13T4U677">amx</span>*(<span class="mxinfo" id="T4:U546"><span class="mxinfo" id="T4:U547"><span class="mxinfo" id="T4:U548"><span class="mxinfo" id="T4:U549"><span class="var type1" id="S28T4U683">q0</span>^2</span> + <span class="mxinfo" id="T4:U551"><span class="var type1" id="S29T4U686">q1</span>^2</span></span> - <span class="mxinfo" id="T4:U553"><span class="var type1" id="S30T4U689">q2</span>^2</span></span> - <span class="mxinfo" id="T4:U555"><span class="var type1" id="S31T4U692">q3</span>^2</span></span>)</span> - <span class="mxinfo" id="T4:U557"><span class="var type1" id="S14T4U695">amy</span>*(<span class="mxinfo" id="T4:U559"><span class="mxinfo" id="T4:U560"><span class="mxinfo" id="T4:U561"><span class="mxinfo" id="T4:U562">2</span>*<span class="var type1" id="S28T4U701">q0</span></span>*<span class="var type1" id="S31T4U702">q3</span></span> - <span class="mxinfo" id="T4:U565"><span class="mxinfo" id="T4:U566"><span class="mxinfo" id="T4:U567">2</span>*<span class="var type1" id="S29T4U706">q1</span></span>*<span class="var type1" id="S30T4U707">q2</span></span></span>)</span></span> + <span class="mxinfo" id="T4:U570"><span class="var type1" id="S15T4U709">amz</span>*(<span class="mxinfo" id="T4:U572"><span class="mxinfo" id="T4:U573"><span class="mxinfo" id="T4:U574"><span class="mxinfo" id="T4:U575">2</span>*<span class="var type1" id="S28T4U715">q0</span></span>*<span class="var type1" id="S30T4U716">q2</span></span> + <span class="mxinfo" id="T4:U578"><span class="mxinfo" id="T4:U579"><span class="mxinfo" id="T4:U580">2</span>*<span class="var type1" id="S29T4U720">q1</span></span>*<span class="var type1" id="S31T4U721">q3</span></span></span>)</span></span>)</span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo" id="T12:U319"><span class="mxinfo" id="T12:U321">        <span class="mxinfo" id="T4:U583"><span class="mxinfo" id="T4:U584"><span class="var type1" id="S24T4U725">bez</span>*(<span class="mxinfo" id="T4:U586"><span class="mxinfo" id="T4:U587"><span class="mxinfo" id="T4:U588"><span class="var type1" id="S17T4U730">bmy</span>*(<span class="mxinfo" id="T4:U590"><span class="mxinfo" id="T4:U591"><span class="mxinfo" id="T4:U592"><span class="mxinfo" id="T4:U593"><span class="var type1" id="S28T4U736">q0</span>^2</span> - <span class="mxinfo" id="T4:U595"><span class="var type1" id="S29T4U739">q1</span>^2</span></span> + <span class="mxinfo" id="T4:U597"><span class="var type1" id="S30T4U742">q2</span>^2</span></span> - <span class="mxinfo" id="T4:U599"><span class="var type1" id="S31T4U745">q3</span>^2</span></span>)</span> + <span class="mxinfo" id="T4:U601"><span class="var type1" id="S16T4U748">bmx</span>*(<span class="mxinfo" id="T4:U603"><span class="mxinfo" id="T4:U604"><span class="mxinfo" id="T4:U605"><span class="mxinfo" id="T4:U606">2</span>*<span class="var type1" id="S28T4U754">q0</span></span>*<span class="var type1" id="S31T4U755">q3</span></span> + <span class="mxinfo" id="T4:U609"><span class="mxinfo" id="T4:U610"><span class="mxinfo" id="T4:U611">2</span>*<span class="var type1" id="S29T4U759">q1</span></span>*<span class="var type1" id="S30T4U760">q2</span></span></span>)</span></span> - <span class="mxinfo" id="T4:U614"><span class="var type1" id="S18T4U762">bmz</span>*(<span class="mxinfo" id="T4:U616"><span class="mxinfo" id="T4:U617"><span class="mxinfo" id="T4:U618"><span class="mxinfo" id="T4:U619">2</span>*<span class="var type1" id="S28T4U768">q0</span></span>*<span class="var type1" id="S29T4U769">q1</span></span> - <span class="mxinfo" id="T4:U622"><span class="mxinfo" id="T4:U623"><span class="mxinfo" id="T4:U624">2</span>*<span class="var type1" id="S30T4U773">q2</span></span>*<span class="var type1" id="S31T4U774">q3</span></span></span>)</span></span>)</span> - <span class="mxinfo" id="T4:U627"><span class="var type1" id="S23T4U776">bey</span>*(<span class="mxinfo" id="T4:U629"><span class="mxinfo" id="T4:U630"><span class="mxinfo" id="T4:U631"><span class="var type1" id="S18T4U781">bmz</span>*(<span class="mxinfo" id="T4:U633"><span class="mxinfo" id="T4:U634"><span class="mxinfo" id="T4:U635"><span class="mxinfo" id="T4:U636"><span class="var type1" id="S28T4U787">q0</span>^2</span> - <span class="mxinfo" id="T4:U638"><span class="var type1" id="S29T4U790">q1</span>^2</span></span> - <span class="mxinfo" id="T4:U640"><span class="var type1" id="S30T4U793">q2</span>^2</span></span> + <span class="mxinfo" id="T4:U642"><span class="var type1" id="S31T4U796">q3</span>^2</span></span>)</span> - <span class="mxinfo" id="T4:U644"><span class="var type1" id="S16T4U799">bmx</span>*(<span class="mxinfo" id="T4:U646"><span class="mxinfo" id="T4:U647"><span class="mxinfo" id="T4:U648"><span class="mxinfo" id="T4:U649">2</span>*<span class="var type1" id="S28T4U805">q0</span></span>*<span class="var type1" id="S30T4U806">q2</span></span> - <span class="mxinfo" id="T4:U652"><span class="mxinfo" id="T4:U653"><span class="mxinfo" id="T4:U654">2</span>*<span class="var type1" id="S29T4U810">q1</span></span>*<span class="var type1" id="S31T4U811">q3</span></span></span>)</span></span> + <span class="mxinfo" id="T4:U657"><span class="var type1" id="S17T4U813">bmy</span>*(<span class="mxinfo" id="T4:U659"><span class="mxinfo" id="T4:U660"><span class="mxinfo" id="T4:U661"><span class="mxinfo" id="T4:U662">2</span>*<span class="var type1" id="S28T4U819">q0</span></span>*<span class="var type1" id="S29T4U820">q1</span></span> + <span class="mxinfo" id="T4:U665"><span class="mxinfo" id="T4:U666"><span class="mxinfo" id="T4:U667">2</span>*<span class="var type1" id="S30T4U824">q2</span></span>*<span class="var type1" id="S31T4U825">q3</span></span></span>)</span></span>)</span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="mxinfo" id="T12:U319"><span class="mxinfo" id="T12:U321">        <span class="mxinfo" id="T4:U670"><span class="mxinfo" id="T4:U671"><span class="var type1" id="S22T4U829">bex</span>*(<span class="mxinfo" id="T4:U673"><span class="mxinfo" id="T4:U674"><span class="mxinfo" id="T4:U675"><span class="var type1" id="S18T4U834">bmz</span>*(<span class="mxinfo" id="T4:U677"><span class="mxinfo" id="T4:U678"><span class="mxinfo" id="T4:U679"><span class="mxinfo" id="T4:U680"><span class="var type1" id="S28T4U840">q0</span>^2</span> - <span class="mxinfo" id="T4:U682"><span class="var type1" id="S29T4U843">q1</span>^2</span></span> - <span class="mxinfo" id="T4:U684"><span class="var type1" id="S30T4U846">q2</span>^2</span></span> + <span class="mxinfo" id="T4:U686"><span class="var type1" id="S31T4U849">q3</span>^2</span></span>)</span> - <span class="mxinfo" id="T4:U688"><span class="var type1" id="S16T4U852">bmx</span>*(<span class="mxinfo" id="T4:U690"><span class="mxinfo" id="T4:U691"><span class="mxinfo" id="T4:U692"><span class="mxinfo" id="T4:U693">2</span>*<span class="var type1" id="S28T4U858">q0</span></span>*<span class="var type1" id="S30T4U859">q2</span></span> - <span class="mxinfo" id="T4:U696"><span class="mxinfo" id="T4:U697"><span class="mxinfo" id="T4:U698">2</span>*<span class="var type1" id="S29T4U863">q1</span></span>*<span class="var type1" id="S31T4U864">q3</span></span></span>)</span></span> + <span class="mxinfo" id="T4:U701"><span class="var type1" id="S17T4U866">bmy</span>*(<span class="mxinfo" id="T4:U703"><span class="mxinfo" id="T4:U704"><span class="mxinfo" id="T4:U705"><span class="mxinfo" id="T4:U706">2</span>*<span class="var type1" id="S28T4U872">q0</span></span>*<span class="var type1" id="S29T4U873">q1</span></span> + <span class="mxinfo" id="T4:U709"><span class="mxinfo" id="T4:U710"><span class="mxinfo" id="T4:U711">2</span>*<span class="var type1" id="S30T4U877">q2</span></span>*<span class="var type1" id="S31T4U878">q3</span></span></span>)</span></span>)</span> - <span class="mxinfo" id="T4:U714"><span class="var type1" id="S24T4U880">bez</span>*(<span class="mxinfo" id="T4:U716"><span class="mxinfo" id="T4:U717"><span class="mxinfo" id="T4:U718"><span class="var type1" id="S16T4U885">bmx</span>*(<span class="mxinfo" id="T4:U720"><span class="mxinfo" id="T4:U721"><span class="mxinfo" id="T4:U722"><span class="mxinfo" id="T4:U723"><span class="var type1" id="S28T4U891">q0</span>^2</span> + <span class="mxinfo" id="T4:U725"><span class="var type1" id="S29T4U894">q1</span>^2</span></span> - <span class="mxinfo" id="T4:U727"><span class="var type1" id="S30T4U897">q2</span>^2</span></span> - <span class="mxinfo" id="T4:U729"><span class="var type1" id="S31T4U900">q3</span>^2</span></span>)</span> - <span class="mxinfo" id="T4:U731"><span class="var type1" id="S17T4U903">bmy</span>*(<span class="mxinfo" id="T4:U733"><span class="mxinfo" id="T4:U734"><span class="mxinfo" id="T4:U735"><span class="mxinfo" id="T4:U736">2</span>*<span class="var type1" id="S28T4U909">q0</span></span>*<span class="var type1" id="S31T4U910">q3</span></span> - <span class="mxinfo" id="T4:U739"><span class="mxinfo" id="T4:U740"><span class="mxinfo" id="T4:U741">2</span>*<span class="var type1" id="S29T4U914">q1</span></span>*<span class="var type1" id="S30T4U915">q2</span></span></span>)</span></span> + <span class="mxinfo" id="T4:U744"><span class="var type1" id="S18T4U917">bmz</span>*(<span class="mxinfo" id="T4:U746"><span class="mxinfo" id="T4:U747"><span class="mxinfo" id="T4:U748"><span class="mxinfo" id="T4:U749">2</span>*<span class="var type1" id="S28T4U923">q0</span></span>*<span class="var type1" id="S30T4U924">q2</span></span> + <span class="mxinfo" id="T4:U752"><span class="mxinfo" id="T4:U753"><span class="mxinfo" id="T4:U754">2</span>*<span class="var type1" id="S29T4U928">q1</span></span>*<span class="var type1" id="S31T4U929">q3</span></span></span>)</span></span>)</span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="mxinfo" id="T12:U319"><span class="mxinfo" id="T12:U321">        <span class="mxinfo" id="T4:U757"><span class="mxinfo" id="T4:U758"><span class="var type1" id="S23T4U933">bey</span>*(<span class="mxinfo" id="T4:U760"><span class="mxinfo" id="T4:U761"><span class="mxinfo" id="T4:U762"><span class="var type1" id="S16T4U938">bmx</span>*(<span class="mxinfo" id="T4:U764"><span class="mxinfo" id="T4:U765"><span class="mxinfo" id="T4:U766"><span class="mxinfo" id="T4:U767"><span class="var type1" id="S28T4U944">q0</span>^2</span> + <span class="mxinfo" id="T4:U769"><span class="var type1" id="S29T4U947">q1</span>^2</span></span> - <span class="mxinfo" id="T4:U771"><span class="var type1" id="S30T4U950">q2</span>^2</span></span> - <span class="mxinfo" id="T4:U773"><span class="var type1" id="S31T4U953">q3</span>^2</span></span>)</span> - <span class="mxinfo" id="T4:U775"><span class="var type1" id="S17T4U956">bmy</span>*(<span class="mxinfo" id="T4:U777"><span class="mxinfo" id="T4:U778"><span class="mxinfo" id="T4:U779"><span class="mxinfo" id="T4:U780">2</span>*<span class="var type1" id="S28T4U962">q0</span></span>*<span class="var type1" id="S31T4U963">q3</span></span> - <span class="mxinfo" id="T4:U783"><span class="mxinfo" id="T4:U784"><span class="mxinfo" id="T4:U785">2</span>*<span class="var type1" id="S29T4U967">q1</span></span>*<span class="var type1" id="S30T4U968">q2</span></span></span>)</span></span> + <span class="mxinfo" id="T4:U788"><span class="var type1" id="S18T4U970">bmz</span>*(<span class="mxinfo" id="T4:U790"><span class="mxinfo" id="T4:U791"><span class="mxinfo" id="T4:U792"><span class="mxinfo" id="T4:U793">2</span>*<span class="var type1" id="S28T4U976">q0</span></span>*<span class="var type1" id="S30T4U977">q2</span></span> + <span class="mxinfo" id="T4:U796"><span class="mxinfo" id="T4:U797"><span class="mxinfo" id="T4:U798">2</span>*<span class="var type1" id="S29T4U981">q1</span></span>*<span class="var type1" id="S31T4U982">q3</span></span></span>)</span></span>)</span> - <span class="mxinfo" id="T4:U801"><span class="var type1" id="S22T4U984">bex</span>*(<span class="mxinfo" id="T4:U803"><span class="mxinfo" id="T4:U804"><span class="mxinfo" id="T4:U805"><span class="var type1" id="S17T4U989">bmy</span>*(<span class="mxinfo" id="T4:U807"><span class="mxinfo" id="T4:U808"><span class="mxinfo" id="T4:U809"><span class="mxinfo" id="T4:U810"><span class="var type1" id="S28T4U995">q0</span>^2</span> - <span class="mxinfo" id="T4:U812"><span class="var type1" id="S29T4U998">q1</span>^2</span></span> + <span class="mxinfo" id="T4:U814"><span class="var type1" id="S30T4U1001">q2</span>^2</span></span> - <span class="mxinfo" id="T4:U816"><span class="var type1" id="S31T4U1004">q3</span>^2</span></span>)</span> + <span class="mxinfo" id="T4:U818"><span class="var type1" id="S16T4U1007">bmx</span>*(<span class="mxinfo" id="T4:U820"><span class="mxinfo" id="T4:U821"><span class="mxinfo" id="T4:U822"><span class="mxinfo" id="T4:U823">2</span>*<span class="var type1" id="S28T4U1013">q0</span></span>*<span class="var type1" id="S31T4U1014">q3</span></span> + <span class="mxinfo" id="T4:U826"><span class="mxinfo" id="T4:U827"><span class="mxinfo" id="T4:U828">2</span>*<span class="var type1" id="S29T4U1018">q1</span></span>*<span class="var type1" id="S30T4U1019">q2</span></span></span>)</span></span> - <span class="mxinfo" id="T4:U831"><span class="var type1" id="S18T4U1021">bmz</span>*(<span class="mxinfo" id="T4:U833"><span class="mxinfo" id="T4:U834"><span class="mxinfo" id="T4:U835"><span class="mxinfo" id="T4:U836">2</span>*<span class="var type1" id="S28T4U1027">q0</span></span>*<span class="var type1" id="S29T4U1028">q1</span></span> - <span class="mxinfo" id="T4:U839"><span class="mxinfo" id="T4:U840"><span class="mxinfo" id="T4:U841">2</span>*<span class="var type1" id="S30T4U1032">q2</span></span>*<span class="var type1" id="S31T4U1033">q3</span></span></span>)</span></span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%      K_ss =1.0e-03 *[   0.0229   -0.0000         0    0.0000    0.0000   -0.0000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%                        -0.0000    0.0228         0    0.0000    0.0000    0.0000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%                         0.0000   -0.0000         0   -0.8837    0.5025    0.4929;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%                        -0.0202    0.0000         0   -0.0000   -0.0000    0.0000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%                         0.0000   -0.0201         0   -0.0000   -0.0000   -0.0000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%                        -0.0000    0.0000         0    0.1741   -0.0990   -0.0971];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%     K_ss =[     0.0019    0.0000         0    0.0000   -0.0000    0.0000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%                 0.0000    0.0019         0   -0.0000    0.0000    0.0000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%                -0.0000   -0.0000         0    0.0010    0.0010    0.0004;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="comment">%                -0.0014   -0.0000         0   -0.0000    0.0000   -0.0000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%                -0.0000   -0.0014         0    0.0000   -0.0000   -0.0000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%                 0.0000    0.0000         0   -0.0002   -0.0001   -0.0001];   </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">%      qt=[x(1) x(2) x(3) x(4)];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%      ii=[1 2 3 4 5 6];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%           x(1:4,:)= x(1:4,:) + quatmultiply([0 (K_ss(1:3,:)*E(ii,:))'],qt)';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">%           x(5:7,:)= x(5:7,:) + I34*quatmultiply(quatmultiply(qinv(qt)',[0; K_ss(4:6,:)*E(ii,:)]'),qt)';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">     <span class="mxinfo" id="T12:U844"><span class="var type1" id="S40T12U1036">inn</span>=<span class="mxinfo" id="T12:U846"><span class="var type1" id="S6T11U1038">K_ss</span>*<span class="var type1" id="S39T12U1039">E</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">     <span class="mxinfo" id="T1:U849"><span class="var type1" id="S41T1U1042">update</span> =<span class="mxinfo" id="T1:U851">[                                                       <span class="mxinfo" id="T4:U852"><span class="mxinfo" id="T4:U853"><span class="mxinfo" id="T4:U854"><span class="mxinfo" id="T4:U855">- <span class="mxinfo" id="T4:U856"><span class="var type1" id="S40T12U1050">inn</span>(<span class="mxinfo" id="T4:U858">1</span>)</span></span>*<span class="var type1" id="S29T4U1052">q1</span></span> - <span class="mxinfo" id="T4:U860"><span class="mxinfo" id="T4:U861"><span class="var type1" id="S40T12U1055">inn</span>(<span class="mxinfo" id="T4:U863">2</span>)</span>*<span class="var type1" id="S30T4U1057">q2</span></span></span> - <span class="mxinfo" id="T4:U865"><span class="mxinfo" id="T4:U866"><span class="var type1" id="S40T12U1060">inn</span>(<span class="mxinfo" id="T4:U868">3</span>)</span>*<span class="var type1" id="S31T4U1062">q3</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"><span class="mxinfo" id="T1:U849"><span class="mxinfo" id="T1:U851">                                                                       <span class="mxinfo" id="T4:U870"><span class="mxinfo" id="T4:U871"><span class="mxinfo" id="T4:U872"><span class="mxinfo" id="T4:U873"><span class="var type1" id="S40T12U1068">inn</span>(<span class="mxinfo" id="T4:U875">1</span>)</span>*<span class="var type1" id="S28T4U1070">q0</span></span> + <span class="mxinfo" id="T4:U877"><span class="mxinfo" id="T4:U878"><span class="var type1" id="S40T12U1073">inn</span>(<span class="mxinfo" id="T4:U880">2</span>)</span>*<span class="var type1" id="S31T4U1075">q3</span></span></span> - <span class="mxinfo" id="T4:U882"><span class="mxinfo" id="T4:U883"><span class="var type1" id="S40T12U1078">inn</span>(<span class="mxinfo" id="T4:U885">3</span>)</span>*<span class="var type1" id="S30T4U1080">q2</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="mxinfo" id="T1:U849"><span class="mxinfo" id="T1:U851">                                                                       <span class="mxinfo" id="T4:U887"><span class="mxinfo" id="T4:U888"><span class="mxinfo" id="T4:U889"><span class="mxinfo" id="T4:U890"><span class="var type1" id="S40T12U1086">inn</span>(<span class="mxinfo" id="T4:U892">2</span>)</span>*<span class="var type1" id="S28T4U1088">q0</span></span> - <span class="mxinfo" id="T4:U894"><span class="mxinfo" id="T4:U895"><span class="var type1" id="S40T12U1091">inn</span>(<span class="mxinfo" id="T4:U897">1</span>)</span>*<span class="var type1" id="S31T4U1093">q3</span></span></span> + <span class="mxinfo" id="T4:U899"><span class="mxinfo" id="T4:U900"><span class="var type1" id="S40T12U1096">inn</span>(<span class="mxinfo" id="T4:U902">3</span>)</span>*<span class="var type1" id="S29T4U1098">q1</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="mxinfo" id="T1:U849"><span class="mxinfo" id="T1:U851">                                                                       <span class="mxinfo" id="T4:U904"><span class="mxinfo" id="T4:U905"><span class="mxinfo" id="T4:U906"><span class="mxinfo" id="T4:U907"><span class="var type1" id="S40T12U1104">inn</span>(<span class="mxinfo" id="T4:U909">1</span>)</span>*<span class="var type1" id="S30T4U1106">q2</span></span> - <span class="mxinfo" id="T4:U911"><span class="mxinfo" id="T4:U912"><span class="var type1" id="S40T12U1109">inn</span>(<span class="mxinfo" id="T4:U914">2</span>)</span>*<span class="var type1" id="S29T4U1111">q1</span></span></span> + <span class="mxinfo" id="T4:U916"><span class="mxinfo" id="T4:U917"><span class="var type1" id="S40T12U1114">inn</span>(<span class="mxinfo" id="T4:U919">3</span>)</span>*<span class="var type1" id="S28T4U1116">q0</span></span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"><span class="mxinfo" id="T1:U849"><span class="mxinfo" id="T1:U851">            <span class="mxinfo" id="T4:U921"><span class="mxinfo" id="T4:U922"><span class="mxinfo" id="T4:U923"><span class="mxinfo" id="T4:U924"><span class="var type1" id="S40T12U1122">inn</span>(<span class="mxinfo" id="T4:U926">4</span>)</span>*(<span class="mxinfo" id="T4:U927"><span class="mxinfo" id="T4:U928"><span class="mxinfo" id="T4:U929"><span class="mxinfo" id="T4:U930"><span class="var type1" id="S28T4U1129">q0</span>^2</span> + <span class="mxinfo" id="T4:U932"><span class="var type1" id="S29T4U1132">q1</span>^2</span></span> - <span class="mxinfo" id="T4:U934"><span class="var type1" id="S30T4U1135">q2</span>^2</span></span> - <span class="mxinfo" id="T4:U936"><span class="var type1" id="S31T4U1138">q3</span>^2</span></span>)</span> + <span class="mxinfo" id="T4:U938"><span class="mxinfo" id="T4:U939"><span class="var type1" id="S40T12U1142">inn</span>(<span class="mxinfo" id="T4:U941">5</span>)</span>*(<span class="mxinfo" id="T4:U942"><span class="mxinfo" id="T4:U943"><span class="mxinfo" id="T4:U944"><span class="mxinfo" id="T4:U945">2</span>*<span class="var type1" id="S28T4U1149">q0</span></span>*<span class="var type1" id="S31T4U1150">q3</span></span> + <span class="mxinfo" id="T4:U948"><span class="mxinfo" id="T4:U949"><span class="mxinfo" id="T4:U950">2</span>*<span class="var type1" id="S29T4U1154">q1</span></span>*<span class="var type1" id="S30T4U1155">q2</span></span></span>)</span></span> - <span class="mxinfo" id="T4:U953"><span class="mxinfo" id="T4:U954"><span class="var type1" id="S40T12U1158">inn</span>(<span class="mxinfo" id="T4:U956">6</span>)</span>*(<span class="mxinfo" id="T4:U957"><span class="mxinfo" id="T4:U958"><span class="mxinfo" id="T4:U959"><span class="mxinfo" id="T4:U960">2</span>*<span class="var type1" id="S28T4U1165">q0</span></span>*<span class="var type1" id="S30T4U1166">q2</span></span> - <span class="mxinfo" id="T4:U963"><span class="mxinfo" id="T4:U964"><span class="mxinfo" id="T4:U965">2</span>*<span class="var type1" id="S29T4U1170">q1</span></span>*<span class="var type1" id="S31T4U1171">q3</span></span></span>)</span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="mxinfo" id="T1:U849"><span class="mxinfo" id="T1:U851">            <span class="mxinfo" id="T4:U968"><span class="mxinfo" id="T4:U969"><span class="mxinfo" id="T4:U970"><span class="mxinfo" id="T4:U971"><span class="var type1" id="S40T12U1177">inn</span>(<span class="mxinfo" id="T4:U973">5</span>)</span>*(<span class="mxinfo" id="T4:U974"><span class="mxinfo" id="T4:U975"><span class="mxinfo" id="T4:U976"><span class="mxinfo" id="T4:U977"><span class="var type1" id="S28T4U1184">q0</span>^2</span> - <span class="mxinfo" id="T4:U979"><span class="var type1" id="S29T4U1187">q1</span>^2</span></span> + <span class="mxinfo" id="T4:U981"><span class="var type1" id="S30T4U1190">q2</span>^2</span></span> - <span class="mxinfo" id="T4:U983"><span class="var type1" id="S31T4U1193">q3</span>^2</span></span>)</span> - <span class="mxinfo" id="T4:U985"><span class="mxinfo" id="T4:U986"><span class="var type1" id="S40T12U1197">inn</span>(<span class="mxinfo" id="T4:U988">4</span>)</span>*(<span class="mxinfo" id="T4:U989"><span class="mxinfo" id="T4:U990"><span class="mxinfo" id="T4:U991"><span class="mxinfo" id="T4:U992">2</span>*<span class="var type1" id="S28T4U1204">q0</span></span>*<span class="var type1" id="S31T4U1205">q3</span></span> - <span class="mxinfo" id="T4:U995"><span class="mxinfo" id="T4:U996"><span class="mxinfo" id="T4:U997">2</span>*<span class="var type1" id="S29T4U1209">q1</span></span>*<span class="var type1" id="S30T4U1210">q2</span></span></span>)</span></span> + <span class="mxinfo" id="T4:U1000"><span class="mxinfo" id="T4:U1001"><span class="var type1" id="S40T12U1213">inn</span>(<span class="mxinfo" id="T4:U1003">6</span>)</span>*(<span class="mxinfo" id="T4:U1004"><span class="mxinfo" id="T4:U1005"><span class="mxinfo" id="T4:U1006"><span class="mxinfo" id="T4:U1007">2</span>*<span class="var type1" id="S28T4U1220">q0</span></span>*<span class="var type1" id="S29T4U1221">q1</span></span> + <span class="mxinfo" id="T4:U1010"><span class="mxinfo" id="T4:U1011"><span class="mxinfo" id="T4:U1012">2</span>*<span class="var type1" id="S30T4U1225">q2</span></span>*<span class="var type1" id="S31T4U1226">q3</span></span></span>)</span></span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line"><span class="mxinfo" id="T1:U849"><span class="mxinfo" id="T1:U851">            <span class="mxinfo" id="T4:U1015"><span class="mxinfo" id="T4:U1016"><span class="mxinfo" id="T4:U1017"><span class="mxinfo" id="T4:U1018"><span class="var type1" id="S40T12U1232">inn</span>(<span class="mxinfo" id="T4:U1020">6</span>)</span>*(<span class="mxinfo" id="T4:U1021"><span class="mxinfo" id="T4:U1022"><span class="mxinfo" id="T4:U1023"><span class="mxinfo" id="T4:U1024"><span class="var type1" id="S28T4U1239">q0</span>^2</span> - <span class="mxinfo" id="T4:U1026"><span class="var type1" id="S29T4U1242">q1</span>^2</span></span> - <span class="mxinfo" id="T4:U1028"><span class="var type1" id="S30T4U1245">q2</span>^2</span></span> + <span class="mxinfo" id="T4:U1030"><span class="var type1" id="S31T4U1248">q3</span>^2</span></span>)</span> + <span class="mxinfo" id="T4:U1032"><span class="mxinfo" id="T4:U1033"><span class="var type1" id="S40T12U1252">inn</span>(<span class="mxinfo" id="T4:U1035">4</span>)</span>*(<span class="mxinfo" id="T4:U1036"><span class="mxinfo" id="T4:U1037"><span class="mxinfo" id="T4:U1038"><span class="mxinfo" id="T4:U1039">2</span>*<span class="var type1" id="S28T4U1259">q0</span></span>*<span class="var type1" id="S30T4U1260">q2</span></span> + <span class="mxinfo" id="T4:U1042"><span class="mxinfo" id="T4:U1043"><span class="mxinfo" id="T4:U1044">2</span>*<span class="var type1" id="S29T4U1264">q1</span></span>*<span class="var type1" id="S31T4U1265">q3</span></span></span>)</span></span> - <span class="mxinfo" id="T4:U1047"><span class="mxinfo" id="T4:U1048"><span class="var type1" id="S40T12U1268">inn</span>(<span class="mxinfo" id="T4:U1050">5</span>)</span>*(<span class="mxinfo" id="T4:U1051"><span class="mxinfo" id="T4:U1052"><span class="mxinfo" id="T4:U1053"><span class="mxinfo" id="T4:U1054">2</span>*<span class="var type1" id="S28T4U1275">q0</span></span>*<span class="var type1" id="S29T4U1276">q1</span></span> - <span class="mxinfo" id="T4:U1057"><span class="mxinfo" id="T4:U1058"><span class="mxinfo" id="T4:U1059">2</span>*<span class="var type1" id="S30T4U1280">q2</span></span>*<span class="var type1" id="S31T4U1281">q3</span></span></span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">     <span class="mxinfo" id="T1:U1062"><span class="var type1" id="S35T1U1284">x</span>=<span class="mxinfo" id="T1:U1064"><span class="var type1" id="S35T1U1286">x</span>+<span class="var type1" id="S41T1U1287">update</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">    <span class="comment">%normalize quaternion</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">    <span class="mxinfo" id="T4:U1067"><span class="var type1" id="S37T4U1290">qnorm</span>=<span class="mxinfo" id="T4:U1069">sqrt(<span class="mxinfo" id="T4:U1070"><span class="mxinfo" id="T4:U1071"><span class="mxinfo" id="T4:U1072"><span class="mxinfo" id="T4:U1073"><span class="mxinfo" id="T4:U1074"><span class="var type1" id="S35T1U1298">x</span>(<span class="mxinfo" id="T4:U1076">1</span>)</span>^2</span>+<span class="mxinfo" id="T4:U1077"><span class="mxinfo" id="T4:U1078"><span class="var type1" id="S35T1U1303">x</span>(<span class="mxinfo" id="T4:U1080">2</span>)</span>^2</span></span>+<span class="mxinfo" id="T4:U1081"><span class="mxinfo" id="T4:U1082"><span class="var type1" id="S35T1U1308">x</span>(<span class="mxinfo" id="T4:U1084">3</span>)</span>^2</span></span>+<span class="mxinfo" id="T4:U1085"><span class="mxinfo" id="T4:U1086"><span class="var type1" id="S35T1U1313">x</span>(<span class="mxinfo" id="T4:U1088">4</span>)</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">    <span class="mxinfo" id="T1:U1089"><span class="var type1" id="S35T1U1318">x</span>=<span class="mxinfo" id="T1:U1091"><span class="mxinfo" id="T16:U1092">[<span class="mxinfo" id="T4:U1093"><span class="mxinfo" id="T4:U1094"><span class="var type1" id="S35T1U1324">x</span>(<span class="mxinfo" id="T4:U1096">1</span>)</span>/<span class="var type1" id="S37T4U1326">qnorm</span></span> <span class="mxinfo" id="T4:U1098"><span class="mxinfo" id="T4:U1099"><span class="var type1" id="S35T1U1329">x</span>(<span class="mxinfo" id="T4:U1101">2</span>)</span>/<span class="var type1" id="S37T4U1331">qnorm</span></span> <span class="mxinfo" id="T4:U1103"><span class="mxinfo" id="T4:U1104"><span class="var type1" id="S35T1U1334">x</span>(<span class="mxinfo" id="T4:U1106">3</span>)</span>/<span class="var type1" id="S37T4U1336">qnorm</span></span> <span class="mxinfo" id="T4:U1108"><span class="mxinfo" id="T4:U1109"><span class="var type1" id="S35T1U1339">x</span>(<span class="mxinfo" id="T4:U1111">4</span>)</span>/<span class="var type1" id="S37T4U1341">qnorm</span></span> <span class="mxinfo" id="T4:U1113"><span class="var type1" id="S35T1U1343">x</span>(<span class="mxinfo" id="T4:U1115">5</span>)</span> <span class="mxinfo" id="T4:U1116"><span class="var type1" id="S35T1U1346">x</span>(<span class="mxinfo" id="T4:U1118">6</span>)</span> <span class="mxinfo" id="T4:U1119"><span class="var type1" id="S35T1U1349">x</span>(<span class="mxinfo" id="T4:U1121">7</span>)</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">    <span class="mxinfo" id="T1:U1122"><span class="var type1" id="S2T1U1353">x_est</span>=<span class="var type1" id="S35T1U1354">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">    <span class="comment">%K_est=reshape(K_ss,1,[]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">    <span class="comment">%debug</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
